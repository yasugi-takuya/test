<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>漢字テーブル</title>
    <style>
        table {
            border-collapse: collapse;  /* 全てのテーブルの枠線を重ねて表示する */
        }
        td {
            border: solid, 1px, #000000;  /* セルのボーダーを設定 */
            text-align: center;  /* 文字の水平位置を中央寄せ */
            padding: 0px;
            background-color: white;
        }
        td div {
            background-color:aquamarine;
            overflow: hidden;  /* はみ出た部分を非表示にする */
        }
        .t1 td div {
            width: 50px;
            height: 100px;
        }
        .t2 td div {
            width: 100px;
            height: 50px;
        }
        .t3 td div {
            width: 33px;
            height: 100px;
        }
        .t4 td div {
            width: 100px;
            height: 33px;
        }
        #Outside {
            position: relative;  /* class_Insideの絶対位置指定の基準にする */
            width: 100px;
            height:100px;
        }
        .class_Inside {
            position: absolute;  /* Outsideを基準に絶対位置で位置を指定する */
            top: 25px;  /* Outsideを基準にしたtop位置指定 */
            left: 25px;  /* Outsideを基準にしたleft位置指定 */
        }
        #Inside {
            width: 50px;
            height:50px;
        }
        #TopOutside {
            position: relative;  /* class_BottomInsideの絶対位置指定の基準にする */
            width: 100px;
            height:100px;
        }
        .class_BottomInside {
            position: absolute;  /* TopOutsideを基準に絶対位置で位置を指定する */
            top: 25px;  /* TopOutsideを基準にしたtop位置指定 */
            left: 25px;  /* TopOutsideを基準にしたleft位置指定 */
        }
        #BottomInside {
            /*border-bottom: none; /* セルの下側のボーダーを消す */
            width: 50px;
            height:75px;
        }
        #BottomOutside {
            position: relative;  /* class_TopInsideの絶対位置指定の基準にする */
            width: 100px;
            height:100px;
        }
        .class_TopInside {
            position: absolute;  /* BottomOutsideを基準に絶対位置で位置を指定する */
            top: px;  /* BottomOutsideを基準にしたtop位置指定 */
            left: 25px;  /* BottomOutsideを基準にしたleft位置指定 */
        }
        #TopInside {
            border-top: none; /* セルの上側のボーダーを消す */
            width: 50px;
            height: 75px;
        }
        #LeftOutside {
            position: relative;  /* class_RightInsideの絶対位置指定の基準にする */
            width: 100px;
            height:100px;
        }
        .class_RightInside {
            position: absolute;  /* LeftOutsideを基準に絶対位置で位置を指定する */
            top: 25px;  /* LeftOutsideを基準にしたtop位置指定 */
            left: 25px;  /* LeftOutsideを基準にしたleft位置指定 */
        }
        #RightInside {
            border-right: none; /* セルの右側のボーダーを消す */
            width: 75px;
            height: 50px;
        }
        #TopLeftOutside {
            position: relative;  /* class_BottomRightInsideの絶対位置指定の基準にする */
            width: 100px;
            height:100px;
        }
        .class_BottomRightInside {
            position: absolute;  /* TopLeftOutsideを基準に絶対位置で位置を指定する */
            top: 25px;  /* TopLeftOutsideを基準にしたtop位置指定 */
            left: 25px;  /* TopLeftOutsideを基準にしたleft位置指定 */
        }
        #BottomRightInside {
            border-bottom: none; /* セルの下側のボーダーを消す */
            border-right: none; /* セルの右側のボーダーを消す */
            width: 75px;
            height: 75px;
        }
        #TopRightOutside {
            position: relative;  /* class_BottomLeftInsideの絶対位置指定の基準にする */
            width: 100px;
            height:100px;
        }
        .class_BottomLeftInside {
            position: absolute;  /* TopRightOutsideを基準に絶対位置で位置を指定する */
            top: 25px;  /* TopRightOutsideを基準にしたtop位置指定 */
            left: 0px;  /* TopRightOutsideを基準にしたleft位置指定 */
        }
        #BottomLeftInside {
            border-bottom: none; /* セルの下側のボーダーを消す */
            border-left: none; /* セルの左側のボーダーを消す */
            width: 75px;
            height: 75px;
        }
        #BottomLeftOutside {
            position: relative;  /* class_TopRightInsideの絶対位置指定の基準にする */
            width: 100px;
            height:100px;
        }
        .class_TopRightInside {
            position: absolute;  /* BottomLeftOutsideを基準に絶対位置で位置を指定する */
            top: 0px;  /* BottomLeftOutsideを基準にしたtop位置指定 */
            left: 25px;  /* BottomLeftOutsideを基準にしたleft位置指定 */
        }
        #TopRightInside {
            border-top: none; /* セルの上側のボーダーを消す */
            border-right: none; /* セルの右側のボーダーを消す */
            width: 75px;
            height: 75px;
        }
        #Center {
            width: 100px;
            height: 100px;
        }
        .table_container {  /* 漢字パーツを設置するテーブルを設置するコンテナ */
            display: inline-block;
        }
        .kanjiPartsContainer {  /* 漢字パーツを設置するコンテナ */
            border: #000000, 1px, solid;  /* ボーダーを設定 */
            height: 300px;
            margin: 10px;
        }
        .dragged-item {  /* 漢字パーツのドロップ前スタイル */
            display: inline-block;  /* サイズやマージンを設定できるようにする */
            user-select: none; /* 文字の選択を禁止する */
            border: #000000, 1px, solid;  /* ボーダーを設定 */
            text-align: center;  /* 文字の水平位置を中央寄せ */
            margin: 5px;
            font-size: 50px;
            width: 70px;
            height: 70px;
            background-color: lightsteelblue;
            overflow: hidden; /* はみ出た部分を非表示にする */
            touch-action: none;  /* スクロールやズームの禁止 */
        }
        .dragged-item-to-drop {  /* 漢字パーツのドロップ後スタイル */
            display: inline-block;  /* サイズやマージンを設定できるようにする */
            user-select: none; /* 文字の選択を禁止する */
            border: none;  /* セルのボーダーを設定 */
            text-align: center;  /* 文字の水平位置を中央寄せ */
            margin: 0px;
            font-size: 50px;
            width: 100%;
            height: 100%;  /* 縦幅、横幅を親要素の100%にする */
            background-color: lightsteelblue;
            overflow: hidden; /* はみ出た部分を非表示にする */
            touch-action: none;  /* スクロールやズームの禁止 */
        }
    </style>
</head>
<body>
    <p>["⿰", "⿱", "⿲", "⿳", "⿴", "⿵", "⿶", "⿷", "⿸", "⿹", "⿺", "⿻"]</p>
    <span class="table_container">
        <p>⿰テーブル</p>
        <table class="t1">
            <tr>
                <td><div class="drop-target" id="Left"></div></td>
                <td><div class="drop-target" id="Right"></div></td>
            </tr>
        </table>
    </span>

    <span class="table_container">
        <p>⿱テーブル</p>
        <table class="t2">
            <tr>
                <td><div class="drop-target" id="Top"></div></td>
            </tr>
            <tr>
                <td><div class="drop-target" id="Bottom"></div></td>
            </tr>
        </table>
    </span>

    <span class="table_container">
        <p>⿲テーブル</p>
        <table class="t3">
            <tr>
                <td><div class="drop-target" id="VerticalLeft"></div></td>
                <td><div class="drop-target" id="VerticalCenter"></div></td>
                <td><div class="drop-target" id="VerticalRight"></div></td>
            </tr>
        </table>
    </span>

    <span class="table_container">
        <p>⿳テーブル</p>
        <table class="t4">
            <tr>
                <td><div class="drop-target" id="ParallelTop"></div></td>
            </tr>
            <tr>
                <td><div class="drop-target" id="ParallelCenter"></div></td>
            </tr>
            <tr>
                <td><div class="drop-target" id="ParallelBottom"></div></td>
            </tr>
        </table>
    </span>

    <span class="table_container">
        <p>⿴テーブル</p>
        <table class="t5">
            <tr>
                <td>
                    <div class="drop-target" id="Outside">
                        <table class="class_Inside">
                            <tr>
                                <td><div class="drop-target" id="Inside"></div></td>
                            </tr>
                        </table>
                    </div>
                </td>
            </tr>
        </table>
    </span>
    
    <span class="table_container">
        <p>⿵テーブル</p>
        <table class="t6">
            <tr>
                <td>
                    <div class="drop-target" id="TopOutside">
                        <table class="class_BottomInside">
                            <tr>
                                <td><div class="drop-target" id="BottomInside"></div></td>
                            </tr>
                        </table>
                    </div>
                </td>
            </tr>
        </table>
    </span>

    <span class="table_container">
        <p>⿶テーブル</p>
        <table class="t7">
            <tr>
                <td>
                    <div class="drop-target" id="BottomOutside">
                        <table class="class_TopInside">
                            <tr>
                                <td><div class="drop-target" id="TopInside"></div></td>
                            </tr>
                        </table>
                    </div>
                </td>
            </tr>
        </table>
    </span>

    <span class="table_container">
        <p>⿷テーブル</p>
        <table class="t8">
            <tr>
                <td>
                    <div class="drop-target" id="LeftOutside">
                        <table class="class_RightInside">
                            <tr>
                                <td><div class="drop-target" id="RightInside"></div></td>
                            </tr>
                        </table>
                    </div>
                </td>
            </tr>
        </table>
    </span>

    <span class="table_container">
        <p>⿸テーブル</p>
        <table class="t9">
            <tr>
                <td>
                    <div class="drop-target" id="TopLeftOutside">
                        <table class="class_BottomRightInside">
                            <tr>
                                <td><div class="drop-target" id="BottomRightInside"></div></td>
                            </tr>
                        </table>
                    </div>
                </td>
            </tr>
        </table>
    </span>

    <span class="table_container">
        <p>⿹テーブル</p>
        <table class="t10">
            <tr>
                <td>
                    <div class="drop-target" id="TopRightOutside">
                        <table class="class_BottomLeftInside">
                            <tr>
                                <td><div class="drop-target" id="BottomLeftInside"></div></td>
                            </tr>
                        </table>
                    </div>
                </td>
            </tr>
        </table>
    </span>

    <span class="table_container">
        <p>⿺テーブル</p>
        <table class="t11">
            <tr>
                <td>
                    <div class="drop-target" id="BottomLeftOutside">
                        <table class="class_TopRightInside">
                            <tr>
                                <td><div class="drop-target" id="TopRightInside"></div></td>
                            </tr>
                        </table>
                    </div>
                </td>
            </tr>
        </table>
    </span>

    <span class="table_container">
        <p>⿻テーブル</p>
        <table class="t12">
            <tr>
                <td><div class="drop-target" id="Center"></div></td>
            </tr>
        </table>
    </span>

    <div class="kanjiPartsContainer">
        <div class="dragged-item" id="a">11111</div>
        <div class="dragged-item" id="b">2</div>
        <div class="dragged-item" id="c">3</div>
    </div>

    <p id="moji"></p>

    <script type="text/javascript">
        let kanjiParts = null;  // 選択されている漢字パーツ
        let parent;  // 漢字パーツの親要素

        const moji = document.getElementById("moji");

        // ドロップ用関数
        const drop = (element, kanjiParts) => {
            
            if (element.className === "drop-target") {  // 漢字パーツをドロップするテーブルのセルなら
                kanjiParts.style.position = "static";  // 漢字パーツの位置指定を通常の配置に戻す
                element.append(kanjiParts);  // 要素の子要素に漢字パーツを追加
                kanjiParts.style.left = 0 + "px";
                kanjiParts.style.top = 0 + "px";
                kanjiParts.className = "dragged-item-to-drop";  // 漢字パーツにドロップ後のCSS適用
                
                //console.log(element.id + "にドロップ");
            }
            else if (element.className === "kanjiPartsContainer") {  // 漢字パーツを並べるコンテナの中なら
                kanjiParts.style.position = "static";  // 漢字パーツの位置指定を通常の配置に戻す
                kanjiParts.className = "dragged-item";  // 漢字パーツにドロップ前のCSS適用
                element.append(kanjiParts);  // 要素の子要素に漢字パーツを追加
                //console.log("ドロップ");
            }
        };
        
        // ドラッグ対象イベント
        document.querySelectorAll(".dragged-item").forEach((element) => {
            /*
            // スマホ用イベント
            // 漢字パーツにタップイベントを設定
            element.addEventListener("touchstart", (event) => {
                if (kanjiParts !== null) return;  // 漢字パーツが選択されていれば処理を終了

                moji.textContent += "touchstartイベント\n";

                kanjiParts = event.target;  // タップされた漢字パーツ
                event.preventDefault();  // ブラウザのデフォルト動作を抑制
                kanjiParts.className = "dragged-item";  // 漢字パーツにドロップ前のCSS適用
                kanjiParts.style.opacity = 0.5;  // 漢字パーツを半透明にする
                parent = kanjiParts.parentElement;  // 漢字パーツの親要素をグローバル変数に保存
                document.body.append(kanjiParts);  // 漢字パーツの親要素をbodyにする(ドロップ可能エリアのrelativeに影響されないようにする)
                kanjiParts.style.position = "absolute";  // 漢字パーツの位置指定を親要素(この場合はbody)を基準にした絶対位置指定に変更
                // 漢字パーツを移動させる
                kanjiParts.style.left = (event.changedTouches[0].pageX - kanjiParts.clientWidth / 2) + "px";
                kanjiParts.style.top = (event.changedTouches[0].pageY - kanjiParts.clientHeight / 2) + "px";
            });

            // 漢字パーツにタッチムーブ(移動)イベントを設定
            element.addEventListener("touchmove", (event) => {
                // イベントが発生したのが選択されている漢字パーツでなければ処理を終了
                if (kanjiParts !== event.target) return;

                event.preventDefault();  // ブラウザのデフォルト動作を抑制
                // 漢字パーツを移動させる
                kanjiParts.style.left = (event.changedTouches[0].pageX - kanjiParts.clientWidth / 2) + "px";
                kanjiParts.style.top = (event.changedTouches[0].pageY - kanjiParts.clientHeight / 2) + "px";
            });

            // 漢字パーツから指を離した際のイベントを設定
            element.addEventListener("touchend", (event) => {
                // イベントが発生したのが選択されている漢字パーツでなければ処理を終了
                if (kanjiParts !== event.target) return;

                event.preventDefault();  // ブラウザのデフォルト動作を抑制
                event.stopPropagation();  // 親要素へのバブリングの停止
                //kanjiParts.style.position = "static";  // 漢字パーツの位置指定を通常の配置に戻す
                kanjiParts.style.opacity = 1;  // 漢字パーツを不透明にする

                kanjiParts.style.pointerEvents = 'none';  // 最前面にある漢字パーツを取得しないようにする
                // 指の下にある要素取得
                const element = document.elementFromPoint(event.changedTouches[0].clientX, event.changedTouches[0].clientY);
                kanjiParts.style.pointerEvents = 'auto';  // 漢字パーツを取得できる設定に戻す
                console.log(element);
                // 漢字パーツがある位置に要素があり、それが漢字パーツをドロップできる要素なら
                if (element !== null && ["drop-target", "kanjiPartsContainer"].includes(element.className)) {
                    drop(element, kanjiParts);  // ドロップする
                }
                else {  // そうでなければ
                    drop(parent, kanjiParts);  // ドロップ前の親要素にドロップし直す
                }
                kanjiParts = null;  // 漢字パーツの選択を解除
            });
            */

            // 漢字パーツにpointerdownイベントを設定
            element.addEventListener("pointerdown", (event) => {
                moji.textContent += "pointerdownイベント\n";

                const kanjiParts = event.target;  // pointerdownされた漢字パーツ
                event.preventDefault();  // ブラウザのデフォルト動作を抑制
                kanjiParts.className = "dragged-item";  // 漢字パーツにドロップ前のCSS適用
                kanjiParts.style.opacity = 0.5;  // 漢字パーツを半透明にする
                parent = kanjiParts.parentElement;  // 漢字パーツの親要素をグローバル変数に保存
                document.body.append(kanjiParts);  // 漢字パーツの親要素をbodyにする(ドロップ可能エリアのrelativeに影響されないようにする)
                kanjiParts.style.position = "absolute";  // 漢字パーツの位置指定を親要素(この場合はbody)を基準にした絶対位置指定に変更
                // 漢字パーツを移動させる
                kanjiParts.style.left = (event.pageX - kanjiParts.clientWidth / 2) + "px";
                kanjiParts.style.top = (event.pageY - kanjiParts.clientHeight / 2) + "px";
            });

            // 漢字パーツにpointermove(移動)イベントを設定
            element.addEventListener("pointermove", (event) => {
                const kanjiParts = event.target;  // pointermove(移動)された漢字パーツ
                event.preventDefault();  // ブラウザのデフォルト動作を抑制
                // 漢字パーツを移動させる
                kanjiParts.style.left = (event.pageX - kanjiParts.clientWidth / 2) + "px";
                kanjiParts.style.top = (event.pageY - kanjiParts.clientHeight / 2) + "px";
                kanjiParts.setPointerCapture(event.pointerId);
            });

            // pointerupイベントを設定
            element.addEventListener("pointerup", (event) => {
                const kanjiParts = event.target;  // pointerupした漢字パーツ
                event.preventDefault();  // ブラウザのデフォルト動作を抑制
                event.stopPropagation();  // 親要素へのバブリングの停止
                //kanjiParts.style.position = "static";  // 漢字パーツの位置指定を通常の配置に戻す
                kanjiParts.style.opacity = 1;  // 漢字パーツを不透明にする

                kanjiParts.style.pointerEvents = 'none';  // 最前面にある漢字パーツを取得しないようにする
                // 指の下にある要素取得
                const element = document.elementFromPoint(event.clientX, event.clientY);
                kanjiParts.style.pointerEvents = 'auto';  // 漢字パーツを取得できる設定に戻す
                //console.log(element);
                // 漢字パーツがある位置に要素があり、それが漢字パーツをドロップできる要素なら
                if (element !== null && ["drop-target", "kanjiPartsContainer"].includes(element.className)) {
                    drop(element, kanjiParts);  // ドロップする
                }
                else {  // そうでなければ
                    drop(parent, kanjiParts);  // ドロップ前の親要素にドロップし直す
                }
            });
        });
        /*
        // PC用イベント
        // ページ全体にクリックイベントを設定
        document.addEventListener("mousedown", (event) => {
            moji.textContent += "mousedownイベント\n";

            // クリックされた位置の最前面にある要素取得
            const kanjiParts = document.elementFromPoint(event.clientX, event.clientY);
            // クリックされた位置に要素があり、それが漢字パーツなら
            if (kanjiParts !== null && kanjiParts.className.includes("dragged-item")) {
                event.preventDefault();  // ブラウザのデフォルト動作を抑制
                kanjiParts.className = "dragged-item";  // 漢字パーツにドロップ前のCSS適用
                kanjiParts.style.opacity = 0.5;  // 漢字パーツを半透明にする
                parent = kanjiParts.parentElement;  // 漢字パーツの親要素をグローバル変数に保存
                document.body.append(kanjiParts);  // 漢字パーツの親要素をbodyにする(ドロップ可能エリアのrelativeに影響されないようにする)
                kanjiParts.style.position = "absolute";  // 漢字パーツの位置指定を親要素(この場合はbody)を基準にした絶対位置指定に変更
                // 漢字パーツを移動させる
                kanjiParts.style.left = (event.pageX - kanjiParts.clientWidth / 2) + "px";
                kanjiParts.style.top = (event.pageY - kanjiParts.clientHeight / 2) + "px";
            }
        });

        // ページ全体にマウスムーブ(移動)イベントを設定
        document.addEventListener("mousemove", (event) => {
            // 移動した位置の最前面にある要素取得
            const kanjiParts = document.elementFromPoint(event.clientX, event.clientY);
            // クリックされた位置に要素があり、それが漢字パーツなら
            if (kanjiParts !== null && kanjiParts.className.includes("dragged-item")) {
                event.preventDefault();  // ブラウザのデフォルト動作を抑制
                // 漢字パーツを移動させる
                kanjiParts.style.left = (event.pageX - kanjiParts.clientWidth / 2) + "px";
                kanjiParts.style.top = (event.pageY - kanjiParts.clientHeight / 2) + "px";
            }
        });

        // ページ全体にマウスのボタンが上がった際のイベントを設定
        document.addEventListener("mouseup", (event) => {
            const kanjiParts = event.target;  // 指を離された漢字パーツ
            event.preventDefault();  // ブラウザのデフォルト動作を抑制
            event.stopPropagation();  // 親要素へのバブリングの停止
            //kanjiParts.style.position = "static";  // 漢字パーツの位置指定を通常の配置に戻す
            kanjiParts.style.opacity = 1;  // 漢字パーツを不透明にする

            kanjiParts.style.pointerEvents = 'none';  // 最前面にある漢字パーツを取得しないようにする
            // 指の下にある要素取得
            const element = document.elementFromPoint(event.clientX, event.clientY);
            kanjiParts.style.pointerEvents = 'auto';  // 漢字パーツを取得できる設定に戻す
            console.log(element);
            // 漢字パーツがある位置に要素があり、それが漢字パーツをドロップできる要素なら
            if (element !== null && ["drop-target", "kanjiPartsContainer"].includes(element.className)) {
                drop(element, kanjiParts);  // ドロップする
            }
            else {  // そうでなければ
                drop(parent, kanjiParts);  // ドロップ前の親要素にドロップし直す
            }
        });
        */
    </script>
</body>
</html>